<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcards Trastornos DSM-5</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f0f0f0;
      overflow-x: hidden; /* Evita el scroll horizontal cuando la barra lateral está oculta */
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tabs button {
      padding: 10px;
      border: 1px solid #999;
      background-color: #eee;
      cursor: pointer;
      border-radius: 5px;
    }
    .tabs button.active {
      background-color: #ccc;
      font-weight: bold;
    }
    .flashcards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Ajustado el min-width */
      gap: 20px; /* Aumentado el espacio entre tarjetas */
      width: 100%;
      max-width: 1200px; /* Ancho máximo para el contenedor de tarjetas */
      padding: 10px;
    }
    .card {
      width: 100%;
      height: 200px; /* Altura fija para las tarjetas */
      perspective: 1000px; /* Para el efecto 3D */
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      display: flex; /* Para centrar el contenido */
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.8s; /* Duración de la animación */
      transform-style: preserve-3d; /* Permite que el contenido 3D de los hijos se muestre correctamente */
      border-radius: 10px;
    }

    .card.is-flipped .card-inner {
      transform: rotateY(180deg); /* Voltear la tarjeta */
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden; /* Oculta la parte trasera cuando no está volteada */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      border-radius: 10px;
      box-sizing: border-box; /* Incluir padding en el tamaño total */
      overflow: auto; /* Para contenido largo */
    }

    .card-front {
      background-color: #e0f7fa; /* Un color suave para el frente */
      color: #333;
      z-index: 2;
      border: 1px solid #b2ebf2;
    }

    .card-back {
      background-color: #ffcdd2; /* Un color suave para la parte trasera */
      color: #333;
      transform: rotateY(180deg); /* Inicialmente girada para que aparezca al voltear */
      border: 1px solid #ef9a9a;
    }

    .card-front h2, .card-back h3 {
        margin-top: 0;
        margin-bottom: 10px;
    }

    .card-back p {
        font-size: 0.9em;
        line-height: 1.4;
    }

    .listen-btn {
      margin-top: 15px; /* Espacio para el botón */
      padding: 8px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background-color 0.2s ease;
    }

    .listen-btn:hover {
      background-color: #0056b3;
    }

    .shuffle-btn {
      margin: 10px 0;
      padding: 10px 20px;
      border: 1px solid #999;
      background-color: #eee;
      cursor: pointer;
      border-radius: 5px;
      font-size: 1em;
    }

    /* --- ESTILOS PARA LA IA CHATBASE --- */
    #ask-ia-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4CAF50; /* Un color distintivo */
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      font-size: 1.2em;
      font-weight: bold;
      z-index: 1000; /* Asegura que esté por encima de otros elementos */
      transition: background-color 0.3s ease;
    }

    #ask-ia-button:hover {
      background-color: #45a049;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Oscurece el fondo */
      z-index: 1010;
      display: none; /* Oculto por defecto */
    }

    .sidebar {
      position: fixed;
      top: 0;
      right: -400px; /* Inicialmente fuera de la pantalla */
      width: 350px; /* Ancho promedio de la barra lateral */
      height: 100%;
      background-color: white;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
      transition: right 0.3s ease-in-out;
      z-index: 1020;
      display: flex;
      flex-direction: column;
    }

    .sidebar.open {
      right: 0; /* Desliza hacia adentro */
    }

    .sidebar-header {
      padding: 15px;
      background-color: #f0f0f0;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sidebar-header h2 {
      margin: 0;
      font-size: 1.2em;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: #333;
    }

    .chatbase-container {
      flex-grow: 1; /* Permite que el contenedor del chat ocupe el espacio restante */
      overflow: hidden; /* Asegura que el chat de Chatbase no se desborde */
    }

    /* Asegúrate de que el widget de Chatbase se ajuste al contenedor */
    #chatbase-bubble-root {
      width: 100% !important;
      height: 100% !important;
      position: relative !important; /* Para que el iframe de Chatbase se ajuste bien */
      right: auto !important; /* Anula las posiciones fijas del widget */
      bottom: auto !important;
      transform: none !important;
    }

    #chatbase-bubble-root iframe {
      width: 100% !important;
      height: 100% !important;
      position: relative !important; /* Anula las posiciones fijas del iframe */
    }

    /* Ocultar la burbuja original de Chatbase cuando usamos nuestra propia interfaz */
    .chatbase-bubble-open { /* Clase que Chatbase añade a su burbuja cuando está abierta */
        display: none !important;
    }
    /* La burbuja original de Chatbase no debe aparecer, ya que la manejamos nosotros */
    [id^='chatbase-widget-bubble-'] {
        display: none !important;
    }

  </style>
</head>
<body>
  <h1>Flashcards Trastornos DSM-5</h1>
  <div class="tabs" id="tabs"></div>
  <div style="text-align:right; width: 100%; max-width: 1200px; padding: 0 10px;">
    <button class="shuffle-btn" onclick="shuffleCards()">Mezclar tarjetas</button>
  </div>
  <div class="flashcards" id="cards"></div>

  <div id="ask-ia-button">ASK-IA</div>

  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Asistente IA</h2>
      <button class="close-btn" onclick="closeSidebar()">×</button>
    </div>
    <div class="chatbase-container" id="chatbase-widget-target">
      </div>
  </div>


  <script>
    const data = {
      "Trastorno Específico del Aprendizaje": [
        { front: "Criterio A", back: "Dificultades en el aprendizaje (mínimo 1 síntoma persistente ≥ 6 meses): 1. Lectura imprecisa/lenta/esforzada. 2. Problemas para comprender lo leído. 3. Dificultades ortográficas. 4. Problemas en expresión escrita. 5. Dificultades con el sentido numérico/cálculo. 6. Problemas en razonamiento matemático." },
        { front: "Criterio B", back: "Aptitudes académicas están cuantificablemente por debajo de lo esperado, interfiriendo con el rendimiento. Confirmado por pruebas estandarizadas o historia clínica." },
        { front: "Criterio C", back: "Los síntomas aparecen en edad escolar, pero pueden no ser evidentes hasta que aumentan las exigencias académicas." },
        { front: "Criterio D", back: "Las dificultades no se explican mejor por discapacidad intelectual, sensorial, trastornos mentales, adversidad psicosocial, idioma o mala enseñanza." },
        { front: "Especificadores", back: "Leve: Puede compensar con apoyo. - Moderado: Requiere apoyo regular e intervenciones. - Grave: Necesita apoyo intensivo; afecta varias áreas." },
        { front: "Especificadores de tipo", back: "Dificultad de lectura 315.00 (f81.0) Dislexia – Dificultad expresión escrita 315.2 (F81.1) – Dificultad matemática 315.1 (F81.2) Discalculia" }
      ],
      "Trastorno Negativista Desafiante (TND)": [
        { front: "Criterio A", back: "Patrón de enfado/desafío/venganza (≥ 6 meses, ≥ 4 síntomas) en al menos 1 contexto no fraternal: pierde la calma, se molesta fácilmente, está resentido, discute con figuras de autoridad, desobedece, molesta, culpa a otros. Vengativo/rencoroso ≥2 veces en 6 meses." },
        { front: "Criterio B", back: "Provoca malestar clínico en sí mismo u otros, o afecta el rendimiento social, académico, ocupacional." },
        { front: "Criterio C", back: "No se explica por trastorno psicótico, afectivo, sustancia, ni desregulación emocional." },
        { front: "Especificar gravedad", back: "Leve: Solo en un contexto - Moderado: En dos contextos - Grave: En tres o más contextos" }
      ],
      "Trastorno de Conducta": [
        { front: "Criterio A", back: "Violación de derechos/normas (≥ 3 síntomas en 12 meses y ≥1 en últimos 6): Agresión a personas, animales, destrucción de propiedad, engaño, robo, acosa, peleas, uso de arma, abuso previo, fuego, invasión, pasar la noche fuera, faltar a la escuela, salir sin permiso" },
        { front: "Criterio B", back: "Malestar clínico significativo en áreas social, académica o laboral." },
        { front: "Criterio C", back: "Si ≥18 años, no debe cumplir criterios de trastorno antisocial." },
        { front: "Tipo de inicio", back: "Infantil (F91.1): Antes de los 10 años - Adolescente (F91.2): Después de los 10 - No especificado (F91.9): Sin datos claros" },
        { front: "Gravedad", back: "Leve: Daño menor - Moderado: Daño intermedio - Grave: Daño considerable" }
      ],
      "Trastorno Explosivo Intermitente": [
        { front: "Criterio A", back: "Arrebatos agresivos recurrentes: 1. Agresión verbal/física sin daño (≥2 veces/semana en 3 meses) - 2. Arrebatos con daño (≥3 veces en 12 meses)" },
        { front: "Criterio B", back: "Agresividad desproporcionada a la provocación." },
        { front: "Criterio C", back: "Impulsivos, no premeditados." },
        { front: "Criterio D", back: "Consecuencias negativas: malestar, impacto funcional o legal." },
        { front: "Criterio E", back: "Edad mínima 6 años (o desarrollo equivalente)" },
        { front: "Criterio F", back: "No atribuible a otros trastornos o sustancias. Puede coexistir si los arrebatos exceden lo esperado." }
      ],
      "TDAH": [
        { front: "Criterio A", back: "Inatención y/o hiperactividad-impulsividad (≥6 síntomas por grupo, ≥6 meses)..." },
        { front: "Criterio B", back: "Síntomas antes de los 12 años." },
        { front: "Criterio C", back: "Presentes en ≥2 contextos." },
        { front: "Criterio D", back: "Impacto funcional claro." },
        { front: "Criterio E", back: "No atribuible a otros trastornos." },
        { front: "Presentación actual", back: "Combinada (F90.2): Inatención + Hiperactividad - Inatenta (F90.0): Solo inatención - Hiperactiva (F90.1): Solo hiperactividad" },
        { front: "Remisión parcial", back: "Síntomas actuales, pero no cumple criterios completos en últimos 6 meses." },
        { front: "Gravedad", back: "Leve: Poco impacto - Moderado: Intermedio - Grave: Deterioro importante" }
      ],
      "Trastorno del Espectro Autista (TEA)": [
        { front: "Criterio A", back: "Déficits persistentes en comunicación e interacción social: 1. Reciprocidad socioemocional - 2. Comunicación no verbal - 3. Relaciones interpersonales" },
        { front: "Criterio B", back: "Conductas, intereses o actividades restringidas (≥2): 1. Movimientos repetitivos - 2. Rutinas rígidas - 3. Intereses intensos - 4. Reacción sensorial inusual." },
        { front: "Criterio C", back: "Síntomas presentes desde el desarrollo temprano." },
        { front: "Criterio D", back: "Deterioro funcional significativo." },
        { front: "Criterio E", back: "No se explican mejor por discapacidad intelectual." },
        { front: "Gravedad", back: "Nivel 1: Requiere apoyo - Nivel 2: Apoyo sustancial - Nivel 3: Apoyo muy sustancial" }
      ]
    };

    let current = Object.keys(data)[0];

    // Web Speech API
    let synth = window.speechSynthesis;
    let currentUtterance = null;

    function speakText(text) {
        if (synth.speaking && currentUtterance) {
            synth.cancel(); // Detiene cualquier lectura actual
        }

        currentUtterance = new SpeechSynthesisUtterance(text);
        currentUtterance.lang = 'es-ES'; // Configura el idioma a español
        currentUtterance.rate = 1;      // Velocidad (0.1 a 10, default 1)
        currentUtterance.pitch = 1;     // Tono (0 a 2, default 1)

        // Asegurarse de que las voces estén cargadas y seleccionar una voz en español si es posible
        const setVoice = () => {
            let voices = synth.getVoices();
            let esVoice = voices.find(voice => voice.lang.startsWith('es')); // Busca cualquier voz en español
            if (esVoice) {
                currentUtterance.voice = esVoice;
            }
            synth.speak(currentUtterance);
        };

        // Si las voces ya están cargadas, úsalas. Si no, espera al evento onvoiceschanged.
        if (synth.getVoices().length > 0) {
            setVoice();
        } else {
            synth.onvoiceschanged = setVoice;
        }
    }

    function loadTabs() {
      const tabContainer = document.getElementById('tabs');
      tabContainer.innerHTML = ''; // Limpiar pestañas existentes
      Object.keys(data).forEach(key => {
        const btn = document.createElement('button');
        btn.textContent = key;
        btn.onclick = () => {
          current = key;
          document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          loadCards();
        };
        if (key === current) btn.classList.add('active');
        tabContainer.appendChild(btn);
      });
    }

    function loadCards() {
      const cardContainer = document.getElementById('cards');
      cardContainer.innerHTML = ''; // Limpiar tarjetas existentes
      (data[current] || []).forEach((cardData) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';

        const cardInnerDiv = document.createElement('div');
        cardInnerDiv.className = 'card-inner';

        const cardFrontDiv = document.createElement('div');
        cardFrontDiv.className = 'card-front';
        cardFrontDiv.innerHTML = `<h2>${cardData.front}</h2><button class="listen-btn">Escuchar</button>`;

        const cardBackDiv = document.createElement('div');
        cardBackDiv.className = 'card-back';
        cardBackDiv.innerHTML = `<h3>${cardData.back}</h3><p>${cardData.back}</p><button class="listen-btn">Escuchar</button>`;


        cardInnerDiv.appendChild(cardFrontDiv);
        cardInnerDiv.appendChild(cardBackDiv);
        cardDiv.appendChild(cardInnerDiv);

        // Click handler for the whole card to flip and read automatically
        cardDiv.addEventListener('click', function(event) {
            // Prevenir que el evento burbujee si el clic fue en el botón "Escuchar"
            if (event.target.classList.contains('listen-btn')) {
                return;
            }

            const isFlipped = cardDiv.classList.toggle('is-flipped');

            // Pequeño retraso para que la animación de volteo comience antes de leer
            setTimeout(() => {
                let textToRead = '';
                if (isFlipped) {
                    // Si la tarjeta está volteada hacia atrás, lee el contenido de la parte trasera
                    textToRead = cardData.back;
                } else {
                    // Si la tarjeta está volteada hacia el frente, lee el contenido de la parte frontal
                    textToRead = cardData.front;
                }
                speakText(textToRead);
            }, 400); // 400ms es la mitad de la duración de la transición (0.8s)
        });

        // Event listener para los botones "Escuchar" dentro de la tarjeta
        cardDiv.querySelectorAll('.listen-btn').forEach(button => {
            button.addEventListener('click', function(event) {
                event.stopPropagation(); // Evitar que la tarjeta se voltee al hacer clic en el botón
                const parentCard = this.closest('.card');
                const isFlipped = parentCard.classList.contains('is-flipped');
                let textToRead = '';
                if (isFlipped) {
                    textToRead = cardData.back;
                } else {
                    textToRead = cardData.front;
                }
                speakText(textToRead);
            });
        });

        cardContainer.appendChild(cardDiv);
      });
    }

    function shuffleCards() {
      if (!data[current]) return;
      data[current] = data[current].sort(() => Math.random() - 0.5);
      loadCards();
    }

    // Cargar pestañas y tarjetas al inicio
    loadTabs();
    loadCards();

    /* --- LÓGICA PARA LA BARRA LATERAL DE LA IA --- */
    const askIaButton = document.getElementById('ask-ia-button');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const chatbaseContainer = document.getElementById('chatbase-widget-target');

    function openSidebar() {
      sidebar.classList.add('open');
      sidebarOverlay.style.display = 'block'; // Mostrar el overlay
    }

    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebarOverlay.style.display = 'none'; // Ocultar el overlay
    }

    askIaButton.addEventListener('click', openSidebar);
    sidebarOverlay.addEventListener('click', closeSidebar); // Cerrar al hacer clic en el overlay

    // Cerrar con la tecla Escape
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeSidebar();
      }
    });

    // Cargar el script de Chatbase DENTRO del contenedor de la barra lateral
    // Esto es crucial para que el widget se renderice dentro de la barra lateral.
    // Además, se modifica el script original para que no cree la burbuja flotante.
    (function(){
        if(!window.chatbase||window.chatbase("getState")!=="initialized"){
            window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};
            window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})
        }
        const onLoad=function(){
            const script=document.createElement("script");
            script.src="https://www.chatbase.co/embed.min.js";
            // Eliminar o modificar la ID si Chatbase la usa para posicionamiento fijo global
            script.id="b8G58Dmvkjy4TIClKQmn2"; // Mantener la ID de Chatbase si es necesaria para su funcionamiento interno
            script.domain="www.chatbase.co";
            
            // Adjuntar el script al contenedor de la barra lateral, no al body
            chatbaseContainer.appendChild(script); 

            // Después de que Chatbase haya cargado su script y el widget,
            // necesitaremos aplicar estilos para que se comporte como queremos dentro de la barra lateral.
            script.onload = () => {
                // Posiblemente necesites inspeccionar el DOM generado por Chatbase
                // y aplicar CSS adicional si la burbuja original aún aparece o si el chat no se ajusta.
                // Los estilos en <head> ya intentan ocultar la burbuja flotante original.
                // Aquí podrías forzar el modo "chat" si Chatbase lo permite explícitamente vía JS.
                // window.chatbase('showChat'); // Esto es un ejemplo, verifica la API de Chatbase
            };
        };
        if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}
    })();
  </script>
</body>
</html>